{{- define "czertainly-lib.secrets.generate_static_password" -}}
{{- $top := index . 0 -}}
{{- $password := index . 1 -}}
{{- /* Create "tmp_vars" dict inside ".Release" to store various stuff. */ -}}
{{- if not (index $top "tmp_vars") -}}
{{-   $_ := set $top "tmp_vars" dict -}}
{{- end -}}
{{- /* Some random ID of this password, in case there will be other random values alongside this instance. */ -}}
{{- $key := printf "%s_%s" $top.Name $password -}}
{{- /* If $key does not yet exist in .Release.tmp_vars, then... */ -}}
{{- if not (index $top.tmp_vars $key) -}}
{{- /* ... store random password under the $key */ -}}
{{-   $_ := set $top.tmp_vars $key (randAlphaNum 20) -}}
{{- end -}}
{{- /* Retrieve previously generated value. */ -}}
{{- index $top.tmp_vars $key -}}
{{- end -}}
